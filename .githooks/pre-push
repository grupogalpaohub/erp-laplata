#!/usr/bin/env bash
set -e
export GIT_STAGED_LIST="$(git diff --cached --name-only; echo; git diff --name-only)"

# 1) INVESTIGAÃ‡ÃƒO PROFUNDA OBRIGATÃ“RIA (anti-preguiÃ§a)
echo "ğŸ” EXECUTANDO INVESTIGAÃ‡ÃƒO PROFUNDA OBRIGATÃ“RIA..."
node scripts/guardrails/deep-investigation.js

# 2) Bloqueios essenciais (rÃ¡pidos)
node scripts/guardrails/anti-loop.js
node -e "try{require.resolve('js-yaml');}catch(e){process.exit(1)}" || npm i -D js-yaml >/dev/null 2>&1
node scripts/guardrails/regression-check.js

# 3) (Opcional) Lint + Tests â€” descomente se quiser travar tambÃ©m aqui
# npm run lint
# npm run test:e2e -w 1

echo 'âœ… pre-push aprovado - investigaÃ§Ã£o profunda concluÃ­da.'