#!/usr/bin/env bash
set -e

echo "ğŸš€ [PRE-PUSH] Iniciando validaÃ§Ã£o antes do push..."

# Lista staged/changed para o preflight ter contexto
export GIT_STAGED_LIST="$(git diff --cached --name-only; echo; git diff --name-only)"

# Roda o preflight hierÃ¡rquico (nÃ£o pede aprovaÃ§Ã£o; sÃ³ barra se estiver errado)
node scripts/guardrails/preflight.js || {
  echo "âŒ Preflight reprovou. Corrija (auth/api/db/porta/schema) e tente de novo."
  exit 2
}

echo "âœ… [PRE-PUSH] ValidaÃ§Ã£o aprovada. Prosseguindo com push."