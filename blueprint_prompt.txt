üß† SYSTEM PROMPT ‚Äî ERP La Plata (Fiori-like, Next 14 + Supabase, Vercel Ready)

Implemente um ERP/CRM modular (MM/WH, SD, CRM, FI, CO) com telas de Setup/Customizing.
Stack: Next.js 14 (App Router, React + TS) + Tailwind + Supabase (DB/Auth/Edge Functions) + Vercel.
Reposit√≥rio: erp-laplata, branches: erp-prod (produ√ß√£o), erp-dev (desenvolvimento), erp-git (integra√ß√£o).

Regras globais (obrigat√≥rias)

Multi-tenant: toda tabela tem tenant_id (text). MVP usa LaplataLunaria.

Planta/Dep√≥sito: plant_id (warehouse). Exatamente 1 is_default=true por tenant (constraint √∫nica parcial).

Moeda: valores em centavos (integer).

Datas: date ou timestamptz conforme indicado.

RLS: todas as tabelas com policies por tenant_id. Leituras/escritas s√≥ do tenant atual.

Numera√ß√£o: usar doc_numbering (n√£o hardcode). Fun√ß√£o at√¥mica next_doc_number.

Sistema de IDs Sequenciais: TODOS os registros principais devem ter IDs √∫nicos e sequenciais:

ID de Materiais: prefixo baseado no tipo (B_ para Brincos, G_ para Gargantilhas, C_ para Cord√µes, A_ para An√©is, P_ para Pulseiras, Ch_ para Chokers, K_ para Kits). Formato: PREFIXO_NUMERO (ex: B_001, G_184).

ID de Fornecedores: SUP_00001, SUP_00002... (sequencial) ou V1234567890 (timestamp-based).

ID de Pedidos de Compra: PO-000001, PO-000002... (sequencial) ou PO-YYYYMM-SEQ6 (com data).

ID de Pedidos de Venda: SO-YYYYMM-SEQ6 (ex: SO-202501-000001) via next_doc_number().

ID de Clientes: CUST-1234567890 (timestamp-based) ou CUST-YYYYMM-SEQ6 (com data).

ID de Dep√≥sitos: WH-001, WH-002... (sequencial) ou PLANT-001, PLANT-002...

ID de Lan√ßamentos Financeiros: FI-YYYYMM-SEQ6, PAY-YYYYMM-SEQ6, REC-YYYYMM-SEQ6...

ID de Movimenta√ß√µes de Estoque: MOV-YYYYMM-SEQ6, ENT-YYYYMM-SEQ6, SAI-YYYYMM-SEQ6...

Gera√ß√£o Autom√°tica: Implementar l√≥gica de gera√ß√£o sequencial para TODOS os m√≥dulos, com valida√ß√£o de unicidade e fallback para timestamp em caso de conflito.

Auth: Supabase Auth (e-mail/password). user_profile.user_id √© o UUID do Supabase.

Service Role: apenas nas Edge Functions. Front usa s√≥ NEXT_PUBLIC_SUPABASE_ANON_KEY.

UI: Fiori-like ‚Äî sidebar fixa, header com busca global, 4 KPIs comparativos no topo, tiles por m√≥dulo.

Ader√™ncia a Free Tier: consultas paginadas, √≠ndices m√≠nimos, nenhuma fun√ß√£o com loops pesados, snapshots de KPI ass√≠ncronos e com caching (detalhes no fim).

KPIs de topo (linha de 4 cards)

Pedidos Hoje ‚Äî subt√≠tulo: ‚ÄúM√©dia di√°ria do m√™s‚Äù.

Receita do M√™s ‚Äî subt√≠tulo: ‚ÄúM√©dia mensal hist√≥rica‚Äù.

Leads Ativos (semana) ‚Äî subt√≠tulo: ‚ÄúM√©dia mensal‚Äù.

Estoque Cr√≠tico (itens) ‚Äî subt√≠tulo: ‚ÄúPNs cr√≠ticos ¬∑ Tend√™ncia de consumo‚Äù.

Renderizar como <KpiCard title value comparisonText trend? />.

üìÅ Estrutura do projeto
erp-laplata/
‚îú‚îÄ frontend/                     # Next 14
‚îÇ  ‚îú‚îÄ src/app/(routes)/
‚îÇ  ‚îÇ  ‚îú‚îÄ launchpad/
‚îÇ  ‚îÇ  ‚îú‚îÄ co|mm|sd|wh|crm|fi/     # m√≥dulos
‚îÇ  ‚îÇ  ‚îî‚îÄ setup/(co|mm|sd|wh|crm|fi)/
‚îÇ  ‚îú‚îÄ src/components/            # KpiCard, ModuleTile, DataTable, forms
‚îÇ  ‚îî‚îÄ src/lib/supabase.ts
‚îú‚îÄ supabase/
‚îÇ  ‚îú‚îÄ migrations/                # DDL + RLS + triggers
‚îÇ  ‚îú‚îÄ seed/                      # seeds iniciais (customizings + dados m√≠nimos)
‚îÇ  ‚îî‚îÄ functions/                 # Edge Functions (setup, po/so, kpi)
‚îî‚îÄ docs/BLUEPRINT_CURSOR.md      # este arquivo

üîå Vari√°veis de ambiente (Cloudflare Pages ‚Üí Project Settings)

NEXT_PUBLIC_APP_NAME = ERP Laplata

NEXT_PUBLIC_SUPABASE_URL = <url do projeto>

NEXT_PUBLIC_SUPABASE_ANON_KEY = <anon key>

(Edge Functions) SUPABASE_SERVICE_ROLE_KEY (apenas no backend, jamais no front)

Build:

Root dir: /

Build command: cd frontend && npm install && npm run build

Output dir: frontend/out

next.config.js com output: 'export' + images.unoptimized = true.

üé® UI & Navega√ß√£o

Sidebar com m√≥dulos (CO, MM, SD, WH, CRM, FI, Analytics).

Launchpad: tiles por m√≥dulo (Central, Dashboard, Setup, Criar Documento).

Form padr√£o (shadcn + zod), tabelas com pagina√ß√£o server-side (TanStack Query).

Permiss√µes: use role_permission para ocultar a√ß√µes/bot√µes (al√©m de RLS no banco).

üóÑÔ∏è Banco de dados ‚Äî Arquitetura Completa

Todas as tabelas possuem tenant_id text. Chaves: simples ou compostas conforme indicado.
Sistema multi-tenant com RLS (Row Level Security) habilitado em todas as tabelas.
Arquitetura otimizada para performance com √≠ndices compostos e triggers autom√°ticos.

## üìä ARQUITETURA DAS TABELAS PRINCIPAIS

### üîê Setup & Seguran√ßa (Core)
```sql
-- Controle de tenants e usu√°rios
tenant: 
  tenant_id(PK), display_name, locale, timezone, created_at, is_active

user_profile: 
  tenant_id, user_id(PK), name, email, role, is_active, created_at, last_login

role_permission: 
  tenant_id, role, resource, action, allowed, created_at

app_setting: 
  tenant_id, key, value, updated_at, created_by

doc_numbering: 
  tenant_id, doc_type, prefix, format, next_seq, is_active, created_at

audit_log: 
  tenant_id, audit_id(PK), table_name, record_pk, action, diff_json, actor_user, created_at
```

### üì¶ MM ‚Äî Material Management (Arquitetura Detalhada)
```sql
-- Fornecedores com valida√ß√£o CPF/CNPJ
mm_vendor: 
  tenant_id, vendor_id(PK), vendor_name, contact_email, contact_phone, 
  document_id, vendor_type(PF|PJ), vendor_rating, addr_street, addr_city, 
  addr_state, addr_zip, addr_country, contact_name, is_active, 
  total_moved_cents, created_at, updated_at

-- Materiais com pre√ßos e categorias
mm_material: 
  tenant_id, mm_material(PK), mm_comercial, mm_desc, mm_mat_type, 
  mm_mat_class, mm_price_cents, barcode, weight_grams, status, 
  mm_pur_link, mm_vendor_id, created_at, updated_at

-- Pedidos de compra com triggers autom√°ticos
mm_purchase_order: 
  tenant_id, mm_order(PK), vendor_id, status, po_date, expected_delivery, 
  notes, total_cents, created_at, updated_at

-- Itens de pedido com c√°lculo autom√°tico
mm_purchase_order_item: 
  tenant_id, po_item_id(PK), mm_order, plant_id, mm_material, 
  mm_qtt numeric, quantity numeric, unit_cost_cents, line_total_cents, 
  currency, material_id, notes, created_at

-- Recebimento de materiais
mm_receiving: 
  tenant_id, recv_id(PK), mm_order, plant_id, mm_material, 
  qty_received numeric, received_at timestamptz, notes
```

### üè≠ WH ‚Äî Warehouse Management (Arquitetura Detalhada)
```sql
-- Dep√≥sitos com controle de default
wh_warehouse: 
  tenant_id, plant_id(PK), name, is_default boolean, 
  addr_street, addr_city, addr_state, addr_zip, is_active, created_at

-- Saldo de estoque em tempo real
wh_inventory_balance: 
  tenant_id, plant_id, mm_material, on_hand_qty numeric, 
  reserved_qty numeric, available_qty numeric, 
  last_movement_at timestamptz, created_at, updated_at
  -- PK composta: (tenant_id, plant_id, mm_material)

-- Ledger de movimenta√ß√µes (opcional no MVP)
wh_inventory_ledger: 
  ledger_id bigserial(PK), tenant_id, plant_id, mm_material, 
  movement_type(IN|OUT|RESERVE|RELEASE|ADJUST), qty numeric, 
  ref_type, ref_id, created_at, notes
```

### üõí SD ‚Äî Sales & Distribution (Arquitetura Detalhada)
```sql
-- Clientes com dados completos
crm_customer: 
  tenant_id, customer_id(PK), name, contact_email, contact_phone, 
  document_id, customer_type(PF|PJ), status, addr_street, addr_city, 
  addr_state, addr_zip, addr_country, contact_name, customer_category, 
  lead_classification, sales_channel, notes, preferred_payment_method, 
  preferred_payment_terms, is_active, created_date, updated_at

-- Pedidos de venda com KPIs
sd_sales_order: 
  tenant_id, so_id(PK), doc_no, customer_id, status, order_date, 
  expected_ship, total_cents, total_final_cents, total_negotiated_cents, 
  payment_method, payment_term, notes, created_at, updated_at

-- Itens de pedido com pre√ßos congelados
sd_sales_order_item: 
  tenant_id, so_id, sku, quantity, unit_price_cents, line_total_cents, 
  material_id, unit_price_cents_at_order, row_no, created_at
  -- PK composta: (tenant_id, so_id, material_id, row_no)

-- Expedi√ß√£o de pedidos
sd_shipment: 
  tenant_id, shipment_id(PK), so_id, warehouse_id, ship_date, 
  status, carrier, tracking_code, notes, created_at

-- Pagamentos
sd_payment: 
  tenant_id, payment_id(PK), so_id, amount_cents, payment_date, 
  payment_method, status, notes, created_at
```

### üß≤ CRM ‚Äî Customer Relationship (Arquitetura Detalhada)
```sql
-- Leads com scoring
crm_lead: 
  tenant_id, lead_id(PK), name, contact_email, contact_phone, 
  source, status, score, owner_user, company, position, 
  lead_source, lead_status, created_date, updated_at

-- Oportunidades com pipeline
crm_opportunity: 
  tenant_id, opp_id(PK), lead_id, stage, est_value_cents, 
  probability, next_action_at, status, owner_user, created_date, updated_at

-- Intera√ß√µes e hist√≥rico
crm_interaction: 
  tenant_id, interaction_id(PK), lead_id, channel, content, 
  sentiment, created_date, created_by
```

### üí∞ FI ‚Äî Financial Management (Arquitetura Detalhada)
```sql
-- Contas financeiras
fi_account: 
  tenant_id, account_id(PK), name, type(caixa|banco|receber|pagar), 
  currency, is_active, created_at

-- Faturas e contas
fi_invoice: 
  tenant_id, invoice_id(PK), source_type(PO|SO), source_id, 
  customer_id, vendor_id, amount_cents, due_date, status, 
  created_date, paid_date

-- Pagamentos
fi_payment: 
  tenant_id, payment_id(PK), invoice_id, account_id, amount_cents, 
  payment_date, method, status, notes, created_at

-- Transa√ß√µes
fi_transaction: 
  tenant_id, transaction_id(PK), account_id, type(credito|debito), 
  amount_cents, ref_type, ref_id, date, description, created_at
```

### üìä CO ‚Äî Controladoria & Dashboard (Arquitetura Detalhada)
```sql
-- Centros de custo
co_cost_center: 
  tenant_id, cc_id(PK), name, parent_cc_id, is_active, created_at

-- Per√≠odos fiscais
co_fiscal_period: 
  tenant_id, period_id(PK), start_date, end_date, status, created_at

-- Defini√ß√µes de KPIs
co_kpi_definition: 
  tenant_id, kpi_key(PK), name, unit, description, calculation_method, 
  refresh_frequency, is_active, created_at

-- Snapshots de KPIs
co_kpi_snapshot: 
  tenant_id, kpi_key, snapshot_at, value_number, meta_json, 
  created_at
  -- PK composta: (tenant_id, kpi_key, snapshot_at)

-- Tiles do dashboard
co_dashboard_tile: 
  tenant_id, tile_id(PK), kpi_key, title, subtitle, order_index, 
  color, is_active, created_at
```

## ü§ñ AUTOMA√á√ïES E TRIGGERS IMPLEMENTADOS

### üîÑ Triggers de C√°lculo Autom√°tico
```sql
-- 1. Congelar pre√ßo e calcular total da linha (MM)
CREATE OR REPLACE FUNCTION freeze_item_price()
RETURNS trigger AS $$
DECLARE
  v_price bigint;
BEGIN
  -- Pega o pre√ßo do material
  SELECT mm_price_cents INTO v_price
  FROM mm_material
  WHERE mm_material = NEW.mm_material;

  IF v_price IS NULL THEN
    RAISE EXCEPTION 'Material % sem pre√ßo cadastrado', NEW.mm_material;
  END IF;

  -- Se unit_cost_cents n√£o foi informado, usa o pre√ßo do material
  IF NEW.unit_cost_cents IS NULL OR NEW.unit_cost_cents <= 0 THEN
    NEW.unit_cost_cents := v_price;
  END IF;

  -- Calcula o total da linha
  NEW.line_total_cents := COALESCE(NEW.mm_qtt, 0) * COALESCE(NEW.unit_cost_cents, 0);

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- 2. Atualizar total do pedido ap√≥s mudan√ßas nos itens (MM)
CREATE OR REPLACE FUNCTION trg_update_po_total()
RETURNS trigger AS $$
DECLARE
  v_tenant text;
  v_order  text;
  v_total  bigint;
BEGIN
  -- Descobre qual pedido/tenant atualizar
  IF TG_OP = 'DELETE' THEN
    v_tenant := OLD.tenant_id;
    v_order  := OLD.mm_order;
  ELSE
    v_tenant := NEW.tenant_id;
    v_order  := NEW.mm_order;
  END IF;

  -- Recalcula o total somando todas as linhas
  SELECT COALESCE(SUM(line_total_cents), 0) INTO v_total
  FROM mm_purchase_order_item
  WHERE tenant_id = v_tenant AND mm_order = v_order;

  -- Atualiza a tabela de cabe√ßalho
  UPDATE mm_purchase_order
  SET total_cents = v_total
  WHERE tenant_id = v_tenant AND mm_order = v_order;

  RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql;

-- 3. Gera√ß√£o autom√°tica de n√∫meros de documento (SD)
CREATE OR REPLACE FUNCTION next_doc_number(tenant_id_param TEXT, doc_type TEXT)
RETURNS TEXT AS $$
DECLARE
  v_next_seq INTEGER;
  v_prefix TEXT;
  v_format TEXT;
  v_doc_number TEXT;
BEGIN
  -- Get the next sequence number atomically
  UPDATE doc_numbering 
  SET next_seq = next_seq + 1
  WHERE tenant_id = tenant_id_param 
    AND doc_type = doc_type 
    AND is_active = TRUE
  RETURNING next_seq, prefix, format INTO v_next_seq, v_prefix, v_format;
  
  -- If no row was updated, create a new one
  IF NOT FOUND THEN
    INSERT INTO doc_numbering (tenant_id, doc_type, prefix, format, next_seq, is_active)
    VALUES (tenant_id_param, doc_type, doc_type, 'YYYY-SEQ3', 1, TRUE)
    ON CONFLICT (tenant_id, doc_type) DO UPDATE SET
        next_seq = doc_numbering.next_seq + 1,
        is_active = TRUE
    RETURNING next_seq, prefix, format INTO v_next_seq, v_prefix, v_format;
  END IF;
  
  -- Format the document number
  CASE v_format
    WHEN 'YYYY-SEQ3' THEN
      v_doc_number := v_prefix || '-' || TO_CHAR(CURRENT_DATE, 'YYYY') || '-' || LPAD(v_next_seq::TEXT, 3, '0');
    WHEN 'YYYYMM-SEQ6' THEN
      v_doc_number := v_prefix || '-' || TO_CHAR(CURRENT_DATE, 'YYYYMM') || '-' || LPAD(v_next_seq::TEXT, 6, '0');
    ELSE
      v_doc_number := v_prefix || '-' || TO_CHAR(CURRENT_DATE, 'YYYY') || '-' || LPAD(v_next_seq::TEXT, 3, '0');
  END CASE;
  
  RETURN v_doc_number;
END;
$$ LANGUAGE plpgsql;

-- 4. Atribuir n√∫mero de documento automaticamente (SD)
CREATE OR REPLACE FUNCTION so_assign_doc_no()
RETURNS TRIGGER AS $$
BEGIN
  IF NEW.so_id IS NULL OR NEW.so_id = '' THEN
    NEW.so_id := next_doc_number(NEW.tenant_id, 'SO');
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

### ‚ö° Triggers Aplicados
```sql
-- Congela pre√ßo e calcula line_total_cents antes de gravar
CREATE TRIGGER trg_freeze_price
BEFORE INSERT OR UPDATE OF mm_qtt, mm_material, unit_cost_cents
ON mm_purchase_order_item
FOR EACH ROW EXECUTE FUNCTION freeze_item_price();

-- Atualiza o total do pedido ap√≥s qualquer mudan√ßa nos itens
CREATE TRIGGER trg_update_po_total
AFTER INSERT OR UPDATE OR DELETE
ON mm_purchase_order_item
FOR EACH ROW EXECUTE FUNCTION trg_update_po_total();

-- Atribui n√∫mero de documento automaticamente em pedidos de venda
CREATE TRIGGER trg_so_assign_doc_no
BEFORE INSERT ON sd_sales_order
FOR EACH ROW EXECUTE FUNCTION so_assign_doc_no();
```

### üîÑ Automa√ß√µes de Estoque
```sql
-- Atualizar saldo de estoque automaticamente
CREATE OR REPLACE FUNCTION update_inventory_balance()
RETURNS TRIGGER AS $$
BEGIN
  -- L√≥gica para atualizar wh_inventory_balance
  -- baseada no tipo de movimenta√ß√£o
  IF TG_OP = 'INSERT' THEN
    -- Atualizar saldo baseado no tipo de movimento
    IF NEW.movement_type = 'IN' THEN
      UPDATE wh_inventory_balance 
      SET on_hand_qty = on_hand_qty + NEW.qty,
          last_movement_at = NEW.created_at
      WHERE tenant_id = NEW.tenant_id 
        AND plant_id = NEW.plant_id 
        AND mm_material = NEW.mm_material;
    ELSIF NEW.movement_type = 'OUT' THEN
      UPDATE wh_inventory_balance 
      SET on_hand_qty = on_hand_qty - NEW.qty,
          last_movement_at = NEW.created_at
      WHERE tenant_id = NEW.tenant_id 
        AND plant_id = NEW.plant_id 
        AND mm_material = NEW.mm_material;
    END IF;
  END IF;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

## üìä DETALHES DE CADA M√ìDULO E FEATURES

### üì¶ MM ‚Äî Material Management (Detalhado)

#### üè¢ Gest√£o de Fornecedores
- **Valida√ß√£o CPF/CNPJ**: Suporte a 11 d√≠gitos (CPF) e 14 d√≠gitos (CNPJ)
- **Campos completos**: Dados b√°sicos, contato, endere√ßo, classifica√ß√£o
- **Rating de fornecedores**: A, B, C baseado em performance
- **Total movimentado**: C√°lculo autom√°tico do valor total negociado
- **Status ativo/inativo**: Controle de fornecedores ativos

#### üìã Gest√£o de Materiais
- **IDs sequenciais**: B_001, G_184, C_200, A_150, P_300, Ch_100, K_050
- **Pre√ßos autom√°ticos**: Carregamento do banco de dados
- **Categorias**: Brincos, Gargantilhas, Cord√µes, An√©is, Pulseiras, Chokers, Kits
- **Classifica√ß√£o**: Prata, Ouro, A√ßo, etc.
- **Status**: Ativo, Rascunho, Arquivado
- **Links de compra**: URLs para cat√°logos de fornecedores

#### üõí Pedidos de Compra
- **Cria√ß√£o autom√°tica**: Interface intuitiva com valida√ß√£o
- **Triggers autom√°ticos**: C√°lculo de pre√ßos e totais
- **Status workflow**: Rascunho ‚Üí Aprovado ‚Üí Recebido ‚Üí Cancelado
- **Valida√ß√£o de pre√ßos**: Verifica√ß√£o se material tem pre√ßo cadastrado
- **Compatibilidade**: Campos quantity e material_id para integra√ß√£o

#### üì• Recebimento
- **Recebimento parcial**: Suporte a recebimentos parciais
- **Atualiza√ß√£o de estoque**: Movimenta√ß√£o autom√°tica do saldo
- **Rastreabilidade**: Hist√≥rico completo de recebimentos

### üõí SD ‚Äî Sales & Distribution (Detalhado)

#### üë• Gest√£o de Clientes
- **Dados completos**: B√°sicos, contato, endere√ßo, prefer√™ncias
- **Tipos**: Pessoa F√≠sica (PF) e Pessoa Jur√≠dica (PJ)
- **Categorias**: Cliente VIP, Regular, Prospect
- **Classifica√ß√£o de leads**: Novo, Qualificado, Convertido
- **Canal de vendas**: Site, WhatsApp, Instagram, etc.

#### üìã Pedidos de Venda
- **Cria√ß√£o inteligente**: Pre√ßos carregados automaticamente
- **KPIs avan√ßados**: Margem de contribui√ß√£o, Lucro (R$ e %), Gap entre valores
- **Status workflow**: Rascunho ‚Üí Pedido Criado ‚Üí Aprovado ‚Üí Faturado ‚Üí Cancelado
- **Valores**: Final calculado + Negociado opcional
- **Campos adicionais**: Forma de pagamento, observa√ß√µes, datas
- **Valida√ß√£o**: Campos obrigat√≥rios e relacionamentos

#### üì¶ Itens de Pedido
- **Pre√ßos congelados**: Valores fixados no momento da cria√ß√£o
- **C√°lculo autom√°tico**: Total = Quantidade √ó Pre√ßo Unit√°rio
- **Materiais**: Integra√ß√£o com cat√°logo de materiais
- **Valida√ß√£o**: Verifica√ß√£o de disponibilidade e pre√ßos

#### üöö Expedi√ß√£o
- **Rastreamento**: C√≥digos de rastreamento
- **Transportadoras**: Integra√ß√£o com correios e transportadoras
- **Status**: Pendente, Parcial, Completo, Cancelado

#### üí≥ Pagamentos
- **M√©todos**: PIX, Cart√£o, Boleto, Dinheiro
- **Status**: Pendente, Pago, Cancelado
- **Integra√ß√£o**: Com sistema financeiro

### üß≤ CRM ‚Äî Customer Relationship (Detalhado)

#### üéØ Gest√£o de Leads
- **Scoring autom√°tico**: Pontua√ß√£o baseada em crit√©rios
- **Fontes**: Instagram, WhatsApp, Site, Indica√ß√£o
- **Status**: Novo, Em Contato, Qualificado, Convertido
- **Propriet√°rio**: Atribui√ß√£o de leads a vendedores

#### üíº Oportunidades
- **Pipeline**: Discovery, Validation, Closing
- **Valor estimado**: Estimativa de valor da oportunidade
- **Probabilidade**: Percentual de fechamento
- **Pr√≥xima a√ß√£o**: Data e descri√ß√£o da pr√≥xima a√ß√£o

#### üìû Intera√ß√µes
- **Canais**: Telefone, Email, WhatsApp, Presencial
- **Sentimento**: Positivo, Neutro, Negativo
- **Hist√≥rico**: Registro completo de todas as intera√ß√µes

### üè≠ WH ‚Äî Warehouse Management (Detalhado)

#### üè¢ Gest√£o de Dep√≥sitos
- **Dep√≥sito padr√£o**: Apenas um por tenant (constraint √∫nica)
- **Endere√ßos**: Dados completos de localiza√ß√£o
- **Status**: Ativo/Inativo

#### üìä Controle de Estoque
- **Saldo em tempo real**: on_hand_qty, reserved_qty, available_qty
- **Movimenta√ß√µes**: Entrada, Sa√≠da, Reserva, Libera√ß√£o, Ajuste
- **Rastreabilidade**: Hist√≥rico completo de movimenta√ß√µes
- **Alertas**: Estoque baixo, zerado, cr√≠tico

#### üìà KPIs de Estoque
- **Valor total**: Valor monet√°rio do invent√°rio
- **Giro de estoque**: Rota√ß√£o anual
- **Efici√™ncia**: Precis√£o do invent√°rio
- **Itens cr√≠ticos**: Produtos com estoque baixo

### üí∞ FI ‚Äî Financial Management (Detalhado)

#### üè¶ Gest√£o de Contas
- **Tipos**: Caixa, Banco, Contas a Receber, Contas a Pagar
- **Moedas**: Suporte a m√∫ltiplas moedas
- **Status**: Ativo/Inativo

#### üìÑ Faturas e Contas
- **Origem**: Pedidos de Compra, Pedidos de Venda
- **Vencimento**: C√°lculo autom√°tico baseado em termos de pagamento
- **Status**: Pendente, Paga, Vencida, Cancelada

#### üí≥ Pagamentos
- **M√©todos**: PIX, Cart√£o, Boleto, Transfer√™ncia
- **Contas**: Integra√ß√£o com contas financeiras
- **Status**: Pendente, Processado, Falhado

#### üìä Transa√ß√µes
- **Tipos**: Cr√©dito, D√©bito
- **Refer√™ncias**: Faturas, Pagamentos, Ajustes
- **Auditoria**: Rastreamento completo de movimenta√ß√µes

### üìä CO ‚Äî Controladoria & Dashboard (Detalhado)

#### üè¢ Centros de Custo
- **Hierarquia**: Estrutura hier√°rquica de centros de custo
- **Status**: Ativo/Inativo
- **Relacionamentos**: Centros pai e filhos

#### üìÖ Per√≠odos Fiscais
- **Controle**: Per√≠odos abertos e fechados
- **Datas**: In√≠cio e fim do per√≠odo
- **Status**: Aberto, Fechado, Bloqueado

#### üìà KPIs e M√©tricas
- **Defini√ß√µes**: Configura√ß√£o de KPIs personalizados
- **C√°lculos**: M√©todos de c√°lculo autom√°tico
- **Frequ√™ncia**: Atualiza√ß√£o autom√°tica (15 min)
- **Snapshots**: Hist√≥rico de valores

#### üéõÔ∏è Dashboard
- **Tiles**: Configura√ß√£o de tiles personalizados
- **Cores**: C√≥digo de cores sem√¢nticas
- **Ordem**: Ordena√ß√£o personalizada
- **Status**: Ativo/Inativo

## üîê Setup & Seguran√ßa (Detalhado)

### üè¢ Controle de Tenants
- **Multi-tenancy**: Isolamento completo por tenant
- **Configura√ß√µes**: Locale, timezone, configura√ß√µes espec√≠ficas
- **Status**: Ativo/Inativo

### üë§ Gest√£o de Usu√°rios
- **Perfis**: Dados completos do usu√°rio
- **Roles**: Admin, Manager, User, Viewer
- **Status**: Ativo/Inativo
- **√öltimo login**: Controle de acesso

### üîê Permiss√µes
- **Recursos**: mm_material, sd_sales_order, etc.
- **A√ß√µes**: read, create, update, delete, approve
- **Controle**: Permiss√µes granulares por usu√°rio

### ‚öôÔ∏è Configura√ß√µes
- **Chave-valor**: Configura√ß√µes flex√≠veis
- **Auditoria**: Quem alterou e quando
- **Versionamento**: Hist√≥rico de mudan√ßas

### üìä Numera√ß√£o de Documentos
- **Tipos**: SO, PO, FI, INV, etc.
- **Formatos**: YYYY-SEQ3, YYYYMM-SEQ6
- **Sequ√™ncia**: Controle at√¥mico de n√∫meros
- **Ativo**: Controle de tipos ativos

### üìù Auditoria
- **Logs**: Registro de todas as altera√ß√µes
- **Diferen√ßas**: JSON com mudan√ßas
- **Usu√°rio**: Quem fez a altera√ß√£o
- **Tabela**: Qual tabela foi alterada

## üîß DETALHES T√âCNICOS E CONFIGURA√á√ïES

### üìä √çndices e Performance
```sql
-- √çndices compostos para performance otimizada
CREATE INDEX idx_mm_purchase_order_item_tenant_order 
ON mm_purchase_order_item(tenant_id, mm_order);

CREATE INDEX idx_mm_receiving_tenant_order 
ON mm_receiving(tenant_id, mm_order);

CREATE UNIQUE INDEX idx_wh_inventory_balance_unique 
ON wh_inventory_balance(tenant_id, plant_id, mm_material);

CREATE INDEX idx_sd_sales_order_item_tenant_so 
ON sd_sales_order_item(tenant_id, so_id);

CREATE INDEX idx_co_kpi_snapshot_tenant_key_time 
ON co_kpi_snapshot(tenant_id, kpi_key, snapshot_at DESC);
```

### üîê Pol√≠ticas RLS (Row Level Security)
```sql
-- Pol√≠tica padr√£o para todas as tabelas
CREATE POLICY tenant_isolation_policy ON [table_name]
FOR ALL TO authenticated
USING (tenant_id = current_setting('request.jwt.claims', true)::json->>'tenant_id');
```

### üîÑ Fluxos de Neg√≥cio Implementados

#### üì¶ Fluxo de Compras (MM ‚Üí WH)
1. **Cria√ß√£o de Pedido**: Interface intuitiva com valida√ß√£o
2. **Aprova√ß√£o**: Mudan√ßa de status com triggers
3. **Recebimento**: Atualiza√ß√£o autom√°tica de estoque
4. **Faturamento**: Integra√ß√£o com m√≥dulo financeiro

#### üõí Fluxo de Vendas (SD ‚Üí WH ‚Üí FI)
1. **Cria√ß√£o de Pedido**: Pre√ßos carregados automaticamente
2. **Confirma√ß√£o**: Reserva de estoque (se configurado)
3. **Expedi√ß√£o**: Baixa de estoque e rastreamento
4. **Pagamento**: Integra√ß√£o com sistema financeiro

### üìä KPIs e M√©tricas Implementados

#### üè† Dashboard Principal
- **Pedidos Hoje**: Contagem de pedidos do dia
- **Receita do M√™s**: Valor total de vendas
- **Leads Ativos**: Leads em processo de qualifica√ß√£o
- **Estoque Cr√≠tico**: Itens com estoque baixo

### üîß APIs e Endpoints Implementados

#### üì¶ MM - Material Management APIs
```
GET    /api/mm/materials              # Listar materiais
POST   /api/mm/materials              # Criar material
PUT    /api/mm/materials/[id]         # Atualizar material
DELETE /api/mm/materials/[id]         # Excluir material
POST   /api/mm/materials/bulk-import  # Importa√ß√£o em lote
GET    /api/mm/vendors                # Listar fornecedores
POST   /api/mm/vendors                # Criar fornecedor
PUT    /api/mm/vendors/[id]           # Atualizar fornecedor
DELETE /api/mm/vendors/[id]           # Excluir fornecedor
GET    /api/mm/purchases              # Listar pedidos de compra
POST   /api/mm/purchases/create       # Criar pedido de compra
PUT    /api/mm/purchases/[id]         # Atualizar pedido
GET    /api/mm/purchases/[id]         # Detalhes do pedido
```

#### üõí SD - Sales & Distribution APIs
```
GET    /api/sd/orders                 # Listar pedidos de venda
POST   /api/sd/orders                 # Criar pedido de venda
PUT    /api/sd/orders/[id]            # Atualizar pedido
GET    /api/sd/orders/[id]            # Detalhes do pedido
PUT    /api/sd/orders/[id]/status     # Mudar status
GET    /api/sd/orders/[id]/items      # Itens do pedido
POST   /api/sd/orders/[id]/items      # Adicionar item
PUT    /api/sd/orders/[id]/items/[item_id] # Atualizar item
DELETE /api/sd/orders/[id]/items/[item_id] # Excluir item
```

#### üß≤ CRM - Customer Relationship APIs
```
GET    /api/crm/customers             # Listar clientes
POST   /api/crm/customers             # Criar cliente
PUT    /api/crm/customers/[id]        # Atualizar cliente
DELETE /api/crm/customers/[id]        # Excluir cliente
GET    /api/crm/customers/[id]        # Detalhes do cliente
GET    /api/crm/leads                 # Listar leads
POST   /api/crm/leads                 # Criar lead
PUT    /api/crm/leads/[id]            # Atualizar lead
GET    /api/crm/opportunities         # Listar oportunidades
POST   /api/crm/opportunities         # Criar oportunidade
```

üéõÔ∏è Customizings / Setup por m√≥dulo

Tabelas de setup (*_setup) + listas definidas pelo usu√°rio (*_def).
Usadas pelas telas de Setup (chips/selects/switches) e validadas no backend.

MM ‚Äî Materiais

mm_setup: default_payment_terms int, default_currency, default_wh_id, require_mat_type bool, require_mat_class bool, allow_zero_price bool, default_uom

mm_category_def: category, is_active

mm_classification_def: classification, is_active

mm_price_channel_def: channel, is_active

mm_currency_def: currency, is_active

mm_vendor_rating_def: rating, is_active

mm_status_def: object_type(material|purchase_order|receiving), status, description?, is_final bool, order_index int

WH ‚Äî Dep√≥sitos

wh_setup: default_plant_id, reserve_policy(no_backorder|allow_backorder), negative_stock_allowed bool, picking_strategy(fifo|lifo)

wh_inventory_status_def (opcional): status(good|damaged|hold), is_active

SD ‚Äî Vendas

sd_setup: backorder_policy(block|allow|partial), pricing_mode(material|price_list), default_channel, auto_reserve_on_confirm bool

sd_order_status_def: status, description?, is_final bool, order_index int

sd_shipment_status_def: status, description?, is_final bool, order_index int

sd_carrier_def: carrier_code, carrier_name, is_active

sd_channel_def: channel, is_active

CRM ‚Äî Leads

crm_setup: require_contact_info bool, auto_convert_on_first_order bool

crm_source_def: source, is_active

crm_lead_status_def: status, description?, order_index int, is_final bool

crm_opp_stage_def: stage, description?, order_index int, is_final bool

FI ‚Äî Financeiro

fi_setup: currency, tax_inclusive bool, default_ar_account_id?, default_ap_account_id?, rounding_policy(bankers|up|down)

fi_payment_method_def: method, display_name, is_active

fi_payment_terms_def: terms_code, description?, days int, is_active

fi_tax_code_def (opcional): tax_code, description?, rate_bp int

CO ‚Äî Controladoria

co_setup: timezone, kpi_refresh_cron

üîê Seguran√ßa (RLS & permiss√µes)

Habilitar RLS em todas as tabelas novas.

Policies padr√£o:

SELECT: tenant_id = current_setting('request.jwt.claims', true)::json->>'tenant_id'

INSERT/UPDATE/DELETE: mesma checagem em USING e WITH CHECK.

role_permission controla UI (n√£o substitui RLS):
resource: mm_material, mm_purchase_order, sd_sales_order, sd_shipment, fi_invoice, crm_lead, co_* etc.
action: read|create|update|delete|approve|receive|confirm|ship.

üîÄ Fluxos principais & APIs (Edge Functions)

Todas as fun√ß√µes recebem/retornam JSON. Autentica√ß√£o por Supabase JWT.
Padr√£o de contrato: { ok: boolean, data?, error? }.
Pagina√ß√£o: ?limit=&offset=. Nunca retornar cole√ß√µes sem pagina√ß√£o.

Setup (para cada m√≥dulo)

GET /setup/:module ‚Üí { setup, defs: {...} }

POST /setup/:module ‚Üí upsert em *_setup

POST /setup/:module/def/:entity ‚Üí create; PUT/DELETE idem

Compras (MM/WH)

POST /po/create ‚Üí cria mm_purchase_order + itens; gera mm_order via doc_numbering

POST /po/approve ‚Üí muda status conforme mm_status_def

POST /po/receive ‚Üí grava em mm_receiving, atualiza wh_inventory_balance (on_hand += qty), opcional: ledger IN

Vendas (SD/WH/FI)

POST /so/create ‚Üí cria sd_sales_order + itens (doc_numbering)

POST /so/confirm ‚Üí se sd_setup.auto_reserve_on_confirm, reserva saldo (reserved += qty), checando backorder_policy

POST /shipment/ship ‚Üí baixa estoque (on_hand -= qty, reserved -= qty se havia), atualiza sd_shipment.status

POST /payment/confirm ‚Üí cria fi_invoice (se n√£o existir), fi_payment e fi_transaction (cr√©dito ou d√©bito)

KPIs (CO)

POST /kpi/refresh (agendado) ‚Üí escreve co_kpi_snapshot para:

kpi_orders_today

kpi_month_revenue_cents

kpi_active_leads

kpi_stock_critical_count

Observa√ß√µes de consist√™ncia

Todas as muta√ß√µes de estoque devem ser transacionais (BEGIN/COMMIT).

wh_warehouse: garantir uma is_default=true por tenant (constraint parcial e valida√ß√£o na fun√ß√£o).

next_doc_number deve fazer UPDATE ‚Ä¶ SET next_seq = next_seq+1 RETURNING para evitar colis√£o.

üå± Seeds m√≠nimos (exemplos)

tenant: LaplataLunaria

user_profile: 1 admin (UUID do Supabase)

doc_numbering: SO/MM/SH/PAY/INV com YYYYMM-SEQ6

wh_warehouse: plant_id=GOIANIA, is_default=true

mm_setup/sd_setup/crm_setup/fi_setup/co_setup: linhas default

Def tables:

MM: category(brinco, colar), classification(prata), currency(BRL), vendor_rating(A,B,C), status(material: active,draft,archived; purchase_order: draft,approved,received,cancelled)

SD: order_status(draft,confirmed,shipped,invoiced,delivered,cancelled), shipment_status(pending,partial,complete,cancelled), carrier(correios,jadlog), channel(site,whatsapp)

CRM: source(instagram,whatsapp,site), lead_status(novo,em_contato,qualificado,convertido), opp_stage(discovery,validation,closing)

FI: payment_method(pix,cartao,boleto), payment_terms(NET30=30d)

CO: tiles 1‚Äì4 apontando para KPIs do topo

Dados de neg√≥cio de exemplo:

Fornecedor SUP_00001, Material BR-001, Dep√≥sito WH-001 (default), Saldo on_hand=100

Cliente CUST-0001, SO SO-YYYYMM-000001 com 1 item

Conta FI ACC-0001 (Banco)

üß™ Valida√ß√µes de neg√≥cio (must-have)

MM Material: se mm_setup.require_mat_type, mm_mat_type n√£o nulo; mm_mat_type ‚àà mm_category_def.active.

Purchase Order: status deve pertencer a mm_status_def(object_type='purchase_order') e seguir ordem (enforce por app/EF).

Reserva/Backorder: respeitar sd_setup.backorder_policy (block/allow/partial).

Warehouse Default: impedir m√∫ltiplos is_default=true por tenant (constraint).

Pagamentos/Faturas: fi_payment_terms_def.days preenche due_date ao emitir fatura.

üß± √çndices & Performance (Free Tier)

√çndices compostos:

ON mm_purchase_order_item(tenant_id, mm_order)

ON mm_receiving(tenant_id, mm_order)

ON wh_inventory_balance(tenant_id, plant_id, mm_material) UNIQUE

ON sd_sales_order_item(tenant_id, so_id)

ON co_kpi_snapshot(tenant_id, kpi_key, snapshot_at DESC)

Pagina√ß√£o sempre (limit 50 default).

Fun√ß√µes leves: nada de loops por toda a base; usar queries agregadas e snapshots para dashboards.

Cache: no frontend, TanStack Query com staleTime 30‚Äì120s para listas est√°veis.

Cron KPI: no free da Supabase, rodar a cada 15 min.

üß∞ Build & Deploy (Vercel Ready)
Vercel

Framework preset: Next.js

Build command: npm run build

Output: .next

Branch de produ√ß√£o: erp-prod

Branch de preview: erp-dev, erp-git

Images: otimizadas automaticamente

Env: NEXT_PUBLIC_* para frontend; SUPABASE_SERVICE_ROLE_KEY para Edge Functions.

Dynamic SSR: Todas as p√°ginas com `export const dynamic = 'force-dynamic'`.

API Routes: Todas com `export const dynamic = 'force-dynamic'` e `runtime = 'nodejs'`.

Supabase

Rodar migra√ß√µes (supabase/migrations) e depois seeds (supabase/seed).

Publicar Edge Functions (supabase functions deploy ‚Ä¶) para: setup_*, po, so, shipment, payment, kpi_refresh.

Habilitar RLS em todas as tabelas novas e aplicar policies padr√£o por tenant.

GitHub

Reposit√≥rio com monorepo simples (frontend + supabase + docs).

CI opcional: lint + typecheck (sem build pesado para n√£o estourar minutos do free).

üßØ Li√ß√µes aprendidas incorporadas (do relat√≥rio de falhas)

Depend√™ncias: travar vers√µes principais (Next 14.0.x, React 18). Evitar libs abandonadas; remover pacotes n√£o usados.

Scripts de import: consolidar em uma EF de bootstrap com valida√ß√£o; logs em import_job/log.

Padroniza√ß√£o de campos: nomes can√¥nicos (ex.: mm_material, plant_id, so_id, mm_order), todos em snake_case.

Vari√°veis de ambiente: usar somente NEXT_PUBLIC_* no front; checagens no next.config.js foram removidas (No more "invalid next.config env").

Bundle Frontend: lazy-load nas p√°ginas de m√≥dulos; evitar √≠cones/packs gigantes.

Queries: todas as tabelas com √≠ndices √∫teis + pagina√ß√£o.

üîê RLS (Row Level Security) e Bypass para Desenvolvimento:

RLS habilitado em todas as tabelas com pol√≠ticas por tenant_id.

Desenvolvimento local: AUTH_DISABLED=true permite bypass do RLS usando SUPABASE_SERVICE_ROLE_KEY.

Service role key: deve ser usado apenas no backend para bypassar RLS quando necess√°rio.

Pol√≠ticas RLS: verificam current_setting('request.jwt.claims', true)::json->>'tenant_id'.

Bypass autom√°tico: quando AUTH_DISABLED=true, usar createClient() diretamente com service role key.

üîß Guardrails e Qualidade de C√≥digo:

Pre-commit hooks: verificam arquivos cr√≠ticos antes do commit.

Preflight script: valida porta, autentica√ß√£o, banco de dados e TypeScript.

Sincroniza√ß√£o autom√°tica: script para commit e push com exclus√£o de .env.local.

Documenta√ß√£o de mudan√ßas: change-intent.json para altera√ß√µes cr√≠ticas de schema.

‚úÖ Checklists de verifica√ß√£o
Ap√≥s migra√ß√µes

 wh_warehouse: exatamente 1 is_default=true por tenant

 RLS habilitada em todas as tabelas novas

 doc_numbering com SO/MM/SH/PAY/INV ativos

Ap√≥s seeds

 mm_*_def, sd_*_def, crm_*_def, fi_*_def preenchidos

 tiles CO configurados (4 KPIs do topo)

 1 fornecedor, 1 material, 1 dep√≥sito (default), 1 cliente

Ap√≥s publicar Edge Functions

 GET /setup/mm retorna setup + defs

 POST /po/create cria PO e itens; receive atualiza estoque

 POST /so/confirm reserva saldo conforme pol√≠tica

 POST /shipment/ship d√° sa√≠da de estoque

 POST /payment/confirm cria invoice/payment/transaction

 POST /kpi/refresh grava snapshots

Vercel

 Vari√°veis NEXT_PUBLIC_* setadas para Production e Preview

 Build aponta para .next

 Branch de produ√ß√£o = erp-prod

 Branch de preview = erp-dev, erp-git

 Deploy autom√°tico configurado

 GitHub Workflows para controle de deploys

üß© Componentes/base de c√≥digo a gerar

<KpiCard /> (valor + comparativo pequeno)

<ModuleTile /> (card com links)

DataTable com pagina√ß√£o server-side

Forms (shadcn) para CRUD de material, fornecedor, cliente, PO/SO

P√°ginas Setup para todos os m√≥dulos (chips/listas/seletores gravando nas tabelas *_def/*_setup)

üîö Observa√ß√µes finais

Este documento √© a fonte √∫nica da verdade para gerar migrations, seeds, Edge Functions e p√°ginas.

Priorize MVP funcional (ciclos: Compra‚ÜíRecebimento‚ÜíEstoque e Venda‚ÜíExpedi√ß√£o‚ÜíPagamento).

Mantenha a compatibilidade com planos free: nada de rotas sem pagina√ß√£o, nada que varra a base inteira, KPIs por snapshot.

Pronto. Gere a implementa√ß√£o respeitando fielmente este blueprint.

üöÄ Funcionalidades Implementadas (Status Atual - 100% Funcional)

‚úÖ Sistema de Numera√ß√£o Sequencial:
- Fun√ß√£o next_doc_number() com controle at√¥mico
- Triggers autom√°ticos para PO e SO
- Formato: SO-YYYY-SEQ3, PO-YYYY-SEQ3
- Tabela doc_numbering com controle por tenant
- Gera√ß√£o autom√°tica para todos os m√≥dulos

‚úÖ M√≥dulo SD (Sales & Distribution) - COMPLETO:
- Cria√ß√£o de pedidos de venda com valida√ß√£o completa
- Edi√ß√£o de pedidos existentes com interface moderna
- Campos: valor final, valor negociado, forma de pagamento, observa√ß√µes, status
- KPIs avan√ßados: Margem de contribui√ß√£o, Lucro (R$ e %), Gap entre valores
- Status workflow: Rascunho ‚Üí Pedido Criado ‚Üí Aprovado ‚Üí Faturado ‚Üí Cancelado
- Pre√ßos carregados automaticamente do database
- C√°lculos autom√°ticos de totais e margens
- Mudan√ßa de status com bot√µes funcionais
- Valida√ß√£o de campos obrigat√≥rios
- Interface responsiva e intuitiva

‚úÖ M√≥dulo MM (Materials Management) - COMPLETO:
- Gest√£o de materiais com pre√ßos e categorias
- Fornecedores com valida√ß√£o de CPF/CNPJ (14 d√≠gitos)
- Importa√ß√£o em lote via CSV com valida√ß√£o
- Cat√°logo com links e pre√ßos atualizados
- Pedidos de compra com triggers autom√°ticos
- C√°lculo autom√°tico de pre√ßos e totais
- Compatibilidade com campos quantity e material_id
- Valida√ß√£o de pre√ßos do banco de dados

‚úÖ M√≥dulo CRM (Customer Relationship) - COMPLETO:
- Gest√£o completa de clientes
- Valida√ß√£o de dados obrigat√≥rios
- Interface Fiori-like moderna
- Edi√ß√£o e exclus√£o de clientes
- Valida√ß√£o de relacionamentos (pedidos associados)
- Campos: dados b√°sicos, contato, endere√ßo, forma de pagamento

‚úÖ Triggers e Automa√ß√£o do Banco - IMPLEMENTADO:
- freeze_item_price(): congela pre√ßos e calcula totais automaticamente
- trg_update_po_total(): atualiza total do pedido em tempo real
- Valida√ß√£o de pre√ßos: verifica se material tem pre√ßo cadastrado
- C√°lculo autom√°tico: line_total_cents = mm_qtt √ó unit_cost_cents
- Compatibilidade total: funciona com campos quantity e material_id
- Performance otimizada: triggers executam apenas quando necess√°rio

‚úÖ Sistema de Autentica√ß√£o - ROBUSTO:
- Bypass para desenvolvimento (AUTH_DISABLED)
- RLS configurado para multi-tenant
- Service role para opera√ß√µes administrativas
- Middleware inteligente para prote√ß√£o de rotas
- Sess√µes persistentes com cookies seguros

‚úÖ Guardrails e Qualidade - AVAN√áADO:
- Pre-commit hooks com valida√ß√£o autom√°tica
- Scripts de valida√ß√£o hier√°rquica
- Exclus√£o autom√°tica de .env.local
- Documenta√ß√£o de mudan√ßas (change-intent.json)
- Sincroniza√ß√£o autom√°tica com GitHub
- Valida√ß√£o TypeScript em tempo real

‚úÖ UI/UX Fiori-like - MODERNO:
- Sidebar fixa com m√≥dulos organizados
- KPIs no topo (4 cards) com cores sem√¢nticas
- Formul√°rios padronizados com valida√ß√£o
- Valida√ß√£o em tempo real com feedback visual
- Layout responsivo mobile-first
- Tema escuro consistente
- Componentes reutiliz√°veis

‚úÖ APIs e Integra√ß√£o - COMPLETO:
- APIs REST para todos os m√≥dulos
- Valida√ß√£o server-side robusta
- Tratamento de erros padronizado
- Pagina√ß√£o server-side para performance
- Integra√ß√£o entre m√≥dulos (SD ‚Üî MM ‚Üî CRM)
- Endpoints de debug para troubleshooting

‚úÖ Banco de Dados - OTIMIZADO:
- Schema atualizado com triggers funcionais
- RLS habilitado em todas as tabelas
- √çndices otimizados para performance
- Valida√ß√µes de integridade referencial
- Pol√≠ticas de seguran√ßa por tenant
- Migra√ß√µes idempotentes

‚úÖ Deploy e Produ√ß√£o - PRONTO:
- Configura√ß√£o Vercel completa
- Vari√°veis de ambiente configuradas
- Deploy autom√°tico por branch
- Monitoramento de erros
- Logs de auditoria
- Backup autom√°tico

üéØ SISTEMA 100% FUNCIONAL E PRONTO PARA PRODU√á√ÉO!